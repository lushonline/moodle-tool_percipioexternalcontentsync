# tool_percipioexternalcontentsync

When Percipio Assets are retrieved the properties need to be mapped to Moodle Categories, Courses and External Content Activities.

Details on the properties can be found in the Skillsoft OpenAPI definition [CatalogContent Schema](https://api.percipio.com/content-discovery/api-docs/)

The work to do this is in [classes/helper.php](classes/helper.php).

The details below summarise how this is done, if you want to change the processing you will need to edit the functions in [classes/helper.php](classes/helper.php).

## Table of Contents

- [Category](#category)
- [Course](#course)
- [External Content](#external-content)

## Category
**MAIN FUNCTION**:  get_percio_asset_category($asset)

| Moodle Property | Comment | Example |
| ---- | ----------- |----------- |
| idnumber | This is a composite value that is the UUID for the first channel association ```associations.channels[0].id``` for an asset, or the id if the Percipio type is a channel or journey ```id``` Followed by an _ and then the primary locale code ```localeCodes[0]```  | 64b58d31-161a-11e7-bf96-7fcd66e560cd_en-US |
| name | This is a composite value that is the title for the first channel association ```associations.channels[0].title``` for an asset, or the  title in the primary locale if the Percipio type is a channel or journey ```localizedMetadata[0].title``` Followed by the primary locale code ```localeCodes[0]``` in square brackets | Microsoft Dynamics Administration [en-US] |

## Course
**MAIN FUNCTION**:  percio_asset_to_externalcontentimport($asset, $parentcategory = null)

| Moodle Property | Comment | Example |
| ---- |  ----------- |----------- |
| idnumber |  This is the xapiActivityId for the asset, this is so that the LRS functionality of the External Content activity can be used. | https://xapi.percipio.com/xapi/lc/ffb5d5a6-90f1-434e-8120-4a31e6a61e90 |
| shortname | This is a composite value that is the title in the primary locale shortened to 215 characters ```localizedMetadata[0].title``` and the ```id`` in round brackets. | Cutover strategy for Dynamics 365 solutions (ffb5d5a6-90f1-434e-8120-4a31e6a61e90) |
| longname | This is the title in the primary locale shortened to 255 characters ```localizedMetadata[0].title```, | Cutover strategy for Dynamics 365 solutions |
| summary | This is a composite value that is HTML text. Generated by the ```get_percio_asset_description($asset)``` helper function | ```Type: Course<br><br>This module will help ensure that a good approach is in place for the planning, incremental readiness, testing, and implementation of the cutover.<br>``` |
| visible | This is the value of ```lifecycle.status```, if true this is 1 or if false it is 0 | 1 |
| thumbnail | This is used to add the thumbnail image to the course if the ```coursethumnail``` setting is enabled. The ```imageUrl``` | ```https://cdn2.percipio.com/public/c/linked-content/images/saved/fe9a490b-f223-43ab-8326-029e1a13107b/134361c7-9ac0-461a-aa92-863058dfd01a/modality/134361c7-9ac0-461a-aa92-863058dfd01a.jpg``` |
| tags | This is a composite value that is | delimited list Generated by the ```get_percio_asset_tags($asset)``` helper function | ```TAG1|TAG2|TAG3``` |


**HELPER FUNCTION**: ```get_percio_asset_description($asset)```
This function returns a HTML block.

This includes if defined:
- The content type: ```contentType.displayLabel```
- The authors as comma delimited list: ```by```
- The the description in the primary locale: ```localizedMetadata[0].description```

**HELPER FUNCTION**: ```get_percio_asset_tags($asset)```
This function returns a | delimited list of tags.

This includes if defined:
- The content type: ```contentType.displayLabel```
- If the Percipio type is a channel or journey: ```localizedMetadata[0].title```
- The keywords: ```keywords```
- The areas from associations: ```associations.areas```
- The subjects from associations: ```associations.subjects```

## External Content
**MAIN FUNCTION**:  percio_asset_to_externalcontentimport($asset, $parentcategory = null)

| Moodle Property | Comment | Example |
| ---- |  ----------- |----------- |
| idnumber |  This is the xapiActivityId for the asset, this is so that the LRS functionality of the External Content activity can be used. | https://xapi.percipio.com/xapi/lc/ffb5d5a6-90f1-434e-8120-4a31e6a61e90 |
| name | This is the title in the primary locale shortened to 255 characters ```localizedMetadata[0].title```, | Cutover strategy for Dynamics 365 solutions |
| intro | This is a composite value that is HTML text. Generated by the ```get_percio_asset_description($asset)``` helper function | ```Type: Course<br><br>This module will help ensure that a good approach is in place for the planning, incremental readiness, testing, and implementation of the cutover.<br>``` |
| content | This is a composite value that is HTML text, that includes the thumbnail image, and a Launch button that are both hyperlinks that open a new window to the content on Percipio. It is generated by a number of helper functions that get combined. Generated by ```get_percio_asset_description_thumbnail($asset).'<br/><br/>'.get_percio_asset_description($asset).'<br/><br/>'.get_percio_asset_description_launchbutton($asset)``` | ```<a href="https://share.percipio.com/cd/CVoG41WKQi-J" target="_blank"><img src="https://docs.microsoft.com/en-us/learn/achievements/cutover-strategy-dynamics-365-social.png" alt="Cutover strategy for Dynamics 365 solutions" style="max-width: 400px" class="img-responsive"></a><br><br>Type: Course<br><br>This module will help ensure that a good approach is in place for the planning, incremental readiness, testing, and implementation of the cutover.<br><br><br><a href="https://share.percipio.com/cd/CVoG41WKQi-J" target="_blank" class="btn btn-primary">Launch</a>``` |
| markcompleteexternally | This is set to 1 for all types, with one exception if `strlower($contentType->percipioType) === 'channel'` as channels do not generate a completion. | 1 |


**HELPER FUNCTION**: ```get_percio_asset_description_thumbnail($asset)```
This function returns a HTML block, this is the thumbnail image that is a hyperlink to Percipio Asset.

This uses:
- The thumbnail: ```imageUrl```
- The launch url: ```link```

**HELPER FUNCTION**: ```get_percio_asset_description($asset)```
See information in Course above.

**HELPER FUNCTION**: ```get_percio_asset_description_launchbutton($asset)```
This function returns a HTML block, that returns a link wit Moodle button classes that is a hyperlink to Percipio Asset.

This uses:
- The launch url: ```link```



